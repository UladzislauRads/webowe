import turtle
import random
import time

# ================== EKRAN ==================
screen = turtle.Screen()
screen.setup(900, 700)
screen.bgcolor("black")
screen.tracer(0)

# ================== ZOLWIE ==================
tree = turtle.Turtle(visible=False)
tree.speed(0)
tree.penup()

decor = turtle.Turtle(visible=False)
decor.speed(0)
decor.penup()

snow = turtle.Turtle(visible=False)
snow.speed(0)
snow.penup()
snow.color("white")

# ================== PARAMETRY ==================
LEVELS = 7
BASE_WIDTH = 420
TOP_WIDTH = 40
LEVEL_HEIGHT = 55

STUMP_WIDTH = 70
STUMP_HEIGHT = 80

STUMP_Y = -260
TREE_START_Y = STUMP_Y + STUMP_HEIGHT   # choinka zaczyna się NAD pniakiem

# ================== PŃIAK ==================
tree.goto(-STUMP_WIDTH / 2, STUMP_Y)
tree.color("sienna")
tree.pendown()
tree.begin_fill()
for _ in range(2):
    tree.forward(STUMP_WIDTH)
    tree.left(90)
    tree.forward(STUMP_HEIGHT)
    tree.left(90)
tree.end_fill()
tree.penup()

# ================== CHOINKA (PEŁNA, CENTRALNA) ==================
levels_data = []
tree.color("darkgreen")

for i in range(LEVELS):
    bottom_width = BASE_WIDTH - i * (BASE_WIDTH - TOP_WIDTH) / LEVELS
    top_width = BASE_WIDTH - (i + 1) * (BASE_WIDTH - TOP_WIDTH) / LEVELS
    y = TREE_START_Y + i * LEVEL_HEIGHT

    levels_data.append((bottom_width, top_width, y))

    tree.goto(-bottom_width / 2, y)
    tree.setheading(0)
    tree.pendown()
    tree.begin_fill()

    tree.forward(bottom_width)
    tree.left(90)
    tree.forward(LEVEL_HEIGHT)
    tree.left(90)
    tree.forward(top_width)
    tree.left(90)
    tree.forward(LEVEL_HEIGHT)
    tree.left(90)

    tree.end_fill()
    tree.penup()

# ================== GWIAZDKA ==================
def draw_star(x, y, size):
    decor.goto(x, y)
    decor.setheading(90)
    decor.color("gold")
    decor.pendown()
    decor.begin_fill()
    for _ in range(5):
        decor.forward(size)
        decor.right(144)
    decor.end_fill()
    decor.penup()

top_y = TREE_START_Y + LEVELS * LEVEL_HEIGHT
draw_star(0, top_y + 15, 45)

# ================== BOMBKI ==================
ornaments = []
colors = ["red", "gold", "blue", "purple", "pink"]

for bottom, top, y in levels_data:
    rows = 3
    for r in range(rows):
        width = bottom - r * (bottom - top) / rows
        count = int(width // 55)
        for i in range(count):
            x = -width/2 + (i + 1) * width / (count + 1)
            ornaments.append((x, y + r * LEVEL_HEIGHT / rows,
                              colors[(i + r) % len(colors)]))

def draw_ornaments():
    for x, y, c in ornaments:
        decor.goto(x, y)
        decor.color(c)
        decor.dot(14)

# ================== LAMPKI ==================
lights = []
light_colors = ["yellow", "orange", "cyan", "white"]

for bottom, top, y in levels_data:
    for _ in range(18):
        x = random.uniform(-bottom/2, bottom/2)
        ly = random.uniform(y + 6, y + LEVEL_HEIGHT - 6)
        lights.append((x, ly))

def draw_lights():
    for x, y in lights:
        decor.goto(x, y)
        decor.color(random.choice(light_colors))
        decor.dot(6)

# ================== ŚNIEG ==================
snowflakes = [[random.randint(-440, 440),
               random.randint(-350, 350)] for _ in range(160)]

def draw_snow():
    snow.clear()
    for flake in snowflakes:
        snow.goto(flake[0], flake[1])
        snow.dot(3)
        flake[1] -= random.randint(1, 4)
        if flake[1] < -350:
            flake[1] = 350
            flake[0] = random.randint(-440, 440)

# ================== PĘTLA ==================
while True:
    decor.clear()
    draw_ornaments()
    draw_lights()
    draw_snow()
    screen.update()
    time.sleep(0.25)
